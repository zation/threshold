"use strict";angular.module("logicMonitorApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCollection"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/threshold.html",controller:"ThresholdCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("logicMonitorApp").controller("ThresholdCtrl",["$scope","Thresholds",function(a,b){a.thresholds=b.getInstance(),a.codes="() > 0 22 0, (22:00 02:00) > 0 22 0, (00:30 01:30) = 11 0 0, (03:30 04:30) < 11 12 0(10:00 11:00) > 0 22 0, (13:30 14:30) = 11 0 0, (15:30 16:30) < 11 12 0",a.thresholds.updateWith(a.codes),a.$watch(function(){return a.thresholds.toString()},function(b){b&&(a.codes=b)}),a.$on("activate",function(b,c){a.$broadcast("deactivate",c)}),a.onAdd=function(b){a.thresholds.add(b)},a.onRemove=function(b){a.thresholds.remove(b)},a.fromOrder=function(a){return a.from?Number(a.from.replace(":",".")):24}}]),angular.module("logicMonitorApp").factory("Thresholds",["$collection","Threshold",function(a,b){var c=a,d=["bright-green","light-blue","green","blue","magenta"],e="purple";c.getColor=function(a,b){return b?e:d[a%d.length]},c.TIMES=[];for(var f=0;24>f;f++)for(var g=0;60>g;g+=15){var h=10>f?"0"+f:f,i=10>g?"0"+g:g;c.TIMES.push(h+":"+i)}return c.COMPARISONS=[{name:"is equal to (=)",operator:"="},{name:"is greater than (>)",operator:">"},{name:"is less than (<)",operator:"<"}],c.prototype.toString=function(){var a=[];return angular.forEach(this.all(),function(b){var c="("+b.from+" "+b.until+") "+b.operator+" "+b.numberForWarning+" "+b.numberForError+" "+b.numberForCritical;a.push(c)}),a.length>0?a.join(", "):null},c.prototype.refreshWith=function(a){this.removeAll().updateWith(a)},c.prototype.updateWith=function(a){var c,d,e,f,g=this;angular.forEach(a.split(","),function(a){c="",d="",e=[0,0,0],a=a.trim().split(")"),f=a[0].substr(1).split(" "),f.length>1&&(c=f[0],d=f[1]);var h=a[1].trim().split(" ");angular.forEach(h.slice(1),function(a,b){a=Number(a),isNaN(a)||(e[b]=a)}),g.add(new b({from:c,until:d,operator:h[0],numberForWarning:e[0],numberForError:e[1],numberForCritical:e[2]}))})},c}]),angular.module("logicMonitorApp").factory("Threshold",function(){var a=function(a){angular.copy(a,this)};return a.prototype.isAllDay=function(){return""===this.from||null===this.from||void 0===this.from},a.prototype.copyDataTo=function(a){a.color=this.color,a.from=this.from,a.until=this.until,a.operator=this.operator,a.numberForWarning=this.numberForWarning,a.numberForError=this.numberForError,a.numberForCritical=this.numberForCritical},a}),angular.module("logicMonitorApp").directive("lmThresholdEditor",["$document",function(a){return{restrict:"EA",templateUrl:"views/thresholdEditor.html",replace:!0,scope:{onSave:"=",onRemove:"=",threshold:"=",index:"="},link:function(b,c){angular.element(c).on("click",function(a){a.stopPropagation();var b=["INPUT","LABEL","SELECT"];b.indexOf(a.target.nodeName)<0&&angular.element(c).find(".from").focus()}),a.on("click",function(a){b.active&&b.$apply(function(){b.cancel(a)})}),a.on("keyup",function(a){27===a.keyCode&&(angular.element(c).find("input, select").blur(),b.$apply(function(){b.cancel(a)}))})},controller:["$scope","Thresholds","Threshold",function(a,b,c){function d(){a.newThreshold=new c({id:"new",from:"",until:a.times[0],operator:a.comparisons[0].operator})}a.times=b.TIMES,a.comparisons=b.COMPARISONS,a.isAdding=void 0===a.threshold,a.isEditing=!a.isAdding,a.isAdding?d():(a.color=b.getColor(a.index,a.threshold.isAllDay()),a.newThreshold=new c,a.threshold.copyDataTo(a.newThreshold)),a.active=!1,a.activate=function(){a.active=!0,a.$emit("activate",a.newThreshold.id)},a.$on("deactivate",function(b,c){c!==a.newThreshold.id&&(a.active=!1)}),a.remove=function(b){b.stopPropagation(),a.onRemove&&a.onRemove(a.threshold)},a.cancel=function(b){b.stopPropagation(),a.active=!1,a.isAdding?d():a.threshold.copyDataTo(a.newThreshold)},a.submit=function(b){b.stopPropagation(),a.active=!1,a.isAdding?(delete a.newThreshold.id,a.onSave(a.newThreshold),d()):a.isEditing&&a.newThreshold.copyDataTo(a.threshold)}}]}}]),angular.module("logicMonitorApp").directive("lmTimeSpam",["Thresholds",function(a){return{restrict:"EA",templateUrl:"views/timeSpam.html",scope:{threshold:"=",index:"="},link:function(b,c){b.$watchCollection("[threshold.from, threshold.until]",function(){if(b.color=a.getColor(b.index,b.threshold.isAllDay()),!b.threshold.isAllDay()){var d=1166,e=Number(b.threshold.from.replace(":",".")),f=Number(b.threshold.until.replace(":",".")),g=angular.element(c).find(".spam").css("z-index",9999-b.index);b.isCrossDay=e>f,b.isCrossDay?(g.eq(0).css({left:0,width:f/24*d}),g.eq(1).css({left:e/24*d,right:0})):g.css({left:e/24*d,width:(f-e)/24*d})}})}}}]);